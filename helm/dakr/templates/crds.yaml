---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: checkpointrestores.dakr.devzero.io
spec:
  group: dakr.devzero.io
  names:
    kind: CheckpointRestore
    listKind: CheckpointRestoreList
    plural: checkpointrestores
    singular: checkpointrestore
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.containers[*].condition.phase
      name: Phase
      type: string
    - jsonPath: .spec.sourceNode
      name: Source
      type: string
    - jsonPath: .spec.targetNode
      name: Target
      type: string
    - jsonPath: .status.containers[*].restoreDuration
      name: Duration
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: CheckpointRestore tracks container checkpoint and restore operations
          done by DAKR.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              connections:
                description: Connections captured at checkpoint time
                items:
                  description: |-
                    Connection represents a TCP connection state captured at checkpoint time.
                    Does not include newPodIP - that's only known at restore time.
                  properties:
                    localPort:
                      description: LocalPort is the port on the pod being migrated
                      type: integer
                    originalDstIP:
                      description: |-
                        OriginalDstIP is the original destination IP that clients used (e.g., ClusterIP).
                        When the pod is a server, this may differ from OriginalPodIP due to kube-proxy DNAT.
                        We need this to create DNAT rules that match on the source node.
                      type: string
                    originalPodIP:
                      description: |-
                        OriginalPodIP is the pod IP from the FIRST migration in a chain.
                        For the first migration, this equals the current pod IP.
                        For chained migrations, this is the IP that external clients/servers know.
                        NAT rules use this so DNAT goes: OriginalPodIP -> newPodIP (skipping intermediates)
                      type: string
                    remoteIP:
                      description: RemoteIP is the peer's IP address (real backend
                        for ClusterIP, direct peer for headless)
                      type: string
                    remotePort:
                      description: RemotePort is the peer's port
                      type: integer
                    role:
                      description: Role is "server" or "client" indicating pod's role
                        in this connection
                      type: string
                  required:
                  - localPort
                  - originalPodIP
                  - remoteIP
                  - remotePort
                  - role
                  type: object
                type: array
                x-kubernetes-list-type: atomic
              containers:
                description: Containers to be restored from checkpoint
                items:
                  properties:
                    checkpointPath:
                      description: CheckpointPath is the local path where checkpoint
                        is stored
                      type: string
                    checkpointServer:
                      description: CheckpointServer to pull the checkpoint data from.
                      properties:
                        host:
                          type: string
                        port:
                          type: integer
                      required:
                      - host
                      - port
                      type: object
                    id:
                      type: string
                    name:
                      type: string
                    ports:
                      description: Ports that were exposed by the container
                      items:
                        format: int32
                        type: integer
                      type: array
                  required:
                  - id
                  - name
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - name
                x-kubernetes-list-type: map
              podOrdinal:
                description: For StatefulSet pods (0, 1, 2...)
                type: integer
              reason:
                description: Reason for the checkpoint (e.g., "DeploymentUpdate",
                  "ResourceUpdate")
                type: string
              recommendationId:
                description: RecommendationID is the unique identifier from the dakr
                  service
                type: string
              serviceIP:
                description: ServiceIP is the IP address of the service after restore
                type: string
              sourceNode:
                description: SourceNode where the checkpoint was created
                type: string
              sourcePod:
                description: SourcePod that was checkpointed
                type: string
              sourcePodIP:
                description: |-
                  SourcePodIP is the IP address of the source pod at checkpoint time
                  Used for updating conntrack entries during restore to preserve TCP connections
                type: string
              targetNode:
                description: TargetNode where the checkpoint should be restored
                type: string
              targetPod:
                description: TargetPod where the checkpoint should be restored
                type: string
              targetPodIP:
                description: TargetPodIP is the IP address of the target pod after
                  restore
                type: string
              workloadKind:
                description: |-
                  Workload matching fields
                  Deployment, StatefulSet, Job, DaemonSet, Pod
                type: string
              workloadName:
                description: Name of the workload
                type: string
            required:
            - containers
            - sourceNode
            type: object
          status:
            properties:
              containers:
                description: Containers indicates the status of the individual container
                  checkpoint restores.
                items:
                  properties:
                    checkpointSize:
                      format: int64
                      type: integer
                    checkpointedAt:
                      format: date-time
                      type: string
                    condition:
                      properties:
                        phase:
                          type: string
                      type: object
                    failedAt:
                      format: date-time
                      type: string
                    failureReason:
                      description: FailureReason provides details about why the restore
                        failed
                      type: string
                    name:
                      type: string
                    restoreDuration:
                      type: string
                    restoredAt:
                      format: date-time
                      type: string
                    transferredBytes:
                      format: int64
                      type: integer
                  required:
                  - condition
                  - name
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - name
                x-kubernetes-list-type: map
            required:
            - containers
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: genericresourcerecommendations.dakr.devzero.io
spec:
  group: dakr.devzero.io
  names:
    kind: GenericResourceRecommendation
    listKind: GenericResourceRecommendationList
    plural: genericresourcerecommendations
    singular: genericresourcerecommendation
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Status
      type: string
    - jsonPath: .status.appliedAt
      name: Applied-At
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: GenericResourceRecommendation represents a stored generic resource
          recommendation that can be applied later
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: GenericResourceRecommendationSpec defines the desired state
              of GenericResourceRecommendation
            properties:
              action:
                description: Action is the action to perform (CREATE, UPDATE, DELETE)
                type: string
              autoApply:
                description: AutoApply determines if this recommendation should be
                  applied automatically
                type: boolean
              kind:
                description: Kind is the kind of the resource
                type: string
              manifest:
                description: Manifest is the YAML/JSON content of the resource
                type: string
              name:
                description: Name is the name of the resource
                type: string
              namespace:
                description: Namespace is the namespace of the resource
                type: string
              priority:
                description: Priority determines the order of applying recommendations
                  (higher priority applied first)
                format: int32
                type: integer
              recommendationId:
                description: RecommendationID is the unique identifier from the dakr
                  service
                type: string
            required:
            - action
            - kind
            - manifest
            - name
            - namespace
            - recommendationId
            type: object
          status:
            default:
              phase: Pending
            description: GenericResourceRecommendationStatus defines the observed
              state of GenericResourceRecommendation
            properties:
              appliedAt:
                description: AppliedAt is the timestamp when the recommendation was
                  applied
                format: date-time
                type: string
              conditions:
                description: Conditions contains the current conditions of the recommendation
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              message:
                description: Message contains human-readable details about the current
                  state
                type: string
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed
                  for this recommendation
                format: int64
                type: integer
              phase:
                default: Pending
                description: Phase represents the current phase of the recommendation
                enum:
                - Pending
                - Applying
                - Applied
                - Failed
                - Skipped
                - Migrating
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: nodegrouprecommendations.dakr.devzero.io
spec:
  group: dakr.devzero.io
  names:
    kind: NodeGroupRecommendation
    listKind: NodeGroupRecommendationList
    plural: nodegrouprecommendations
    singular: nodegrouprecommendation
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Status
      type: string
    - jsonPath: .status.appliedAt
      name: Applied-At
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: NodeGroupRecommendation represents a stored node group recommendation
          that can be applied later
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: NodeGroupRecommendationSpec defines the desired state of
              NodeGroupRecommendation
            properties:
              autoApply:
                description: AutoApply determines if this recommendation should be
                  applied automatically
                type: boolean
              currentNodeCount:
                description: CurrentNodeCount is the current number of nodes in the
                  node group
                type: integer
              desiredNodeCount:
                description: DesiredNodeCount is the desired number of nodes in the
                  node group
                type: integer
              nodeGroupName:
                description: NodeGroupName is the name of the target node group
                type: string
              nodesToRemove:
                description: NodesToRemove contains the list of nodes to be removed
                items:
                  type: string
                type: array
              priority:
                description: Priority determines the order of applying recommendations
                  (higher priority applied first)
                format: int32
                type: integer
              recommendationId:
                description: RecommendationID is the unique identifier from the dakr
                  service
                type: string
            required:
            - nodeGroupName
            - recommendationId
            type: object
          status:
            default:
              phase: Pending
            description: NodeGroupRecommendationStatus defines the observed state
              of NodeGroupRecommendation
            properties:
              appliedAt:
                description: AppliedAt is the timestamp when the recommendation was
                  applied
                format: date-time
                type: string
              conditions:
                description: Conditions contains the current conditions of the recommendation
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              message:
                description: Message contains human-readable details about the current
                  state
                type: string
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed
                  for this recommendation
                format: int64
                type: integer
              phase:
                default: Pending
                description: Phase represents the current phase of the recommendation
                enum:
                - Pending
                - Applying
                - Applied
                - Failed
                - Skipped
                - Migrating
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: workloadrecommendations.dakr.devzero.io
spec:
  group: dakr.devzero.io
  names:
    kind: WorkloadRecommendation
    listKind: WorkloadRecommendationList
    plural: workloadrecommendations
    singular: workloadrecommendation
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Status
      type: string
    - jsonPath: .spec.kind
      name: Kind
      type: string
    - jsonPath: .spec.name
      name: Workload
      type: string
    - jsonPath: .spec.actionTriggers
      name: Action
      type: string
    - jsonPath: .spec.useLiveMigration
      name: LiveMigration
      type: string
    - jsonPath: .spec.schedulerName
      name: Scheduler
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.appliedAt
      name: Last-Applied
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: WorkloadRecommendation represents a stored workload recommendation
          that can be applied later
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkloadRecommendationSpec defines the desired state of WorkloadRecommendation
            properties:
              actionTriggers:
                description: ActionTriggers contains the list of action triggers for
                  the recommendation
                items:
                  description: ActionTrigger represents a trigger for an action
                  enum:
                  - OnDetection
                  - Immediate
                  type: string
                type: array
              annotations:
                additionalProperties:
                  type: string
                description: Annotations is the annotations for the workload
                type: object
              autoApply:
                description: AutoApply determines if this recommendation should be
                  applied automatically
                type: boolean
              containerRecommendations:
                description: ContainerRecommendations contains the resource recommendations
                  for each container
                items:
                  description: |-
                    ContainerRecommendationSpec is a plain Go struct for CRD serialization
                    replaces ContainerRecommendationWrapper
                  properties:
                    containerName:
                      type: string
                    cpuLimitsAdjustmentEnabled:
                      description: CpuLimitsAdjustmentEnabled indicates if the policy
                        allows CPU limits to be adjusted
                      type: boolean
                    currentLimit:
                      properties:
                        cpu:
                          format: int64
                          type: integer
                        cpuAction:
                          type: string
                        gpu:
                          format: int64
                          type: integer
                        gpuAction:
                          type: string
                        gpuVram:
                          format: int64
                          type: integer
                        gpuVramAction:
                          type: string
                        memAction:
                          type: string
                        memory:
                          format: int64
                          type: integer
                      type: object
                    currentRequest:
                      properties:
                        cpu:
                          format: int64
                          type: integer
                        cpuAction:
                          type: string
                        gpu:
                          format: int64
                          type: integer
                        gpuAction:
                          type: string
                        gpuVram:
                          format: int64
                          type: integer
                        gpuVramAction:
                          type: string
                        memAction:
                          type: string
                        memory:
                          format: int64
                          type: integer
                      type: object
                    maxCpu:
                      description: MaxCpu is the maximum allowed CPU limit in millicores
                      format: int64
                      type: integer
                    maxMemory:
                      description: MaxMemory is the maximum allowed Memory limit in
                        bytes
                      format: int64
                      type: integer
                    memoryLimitsAdjustmentEnabled:
                      description: MemoryLimitsAdjustmentEnabled indicates if the
                        policy allows Memory limits to be adjusted
                      type: boolean
                    minCpu:
                      description: MinCpu is the minimum allowed CPU limit in millicores
                      format: int64
                      type: integer
                    minMemory:
                      description: MinMemory is the minimum allowed Memory limit in
                        bytes
                      format: int64
                      type: integer
                    optimizationScore:
                      description: OptimizationScore is the score of the recommendation
                      type: number
                    recommendedLimit:
                      description: RecommendedLimit contains the recommended resource
                        limits
                      properties:
                        cpu:
                          format: int64
                          type: integer
                        cpuAction:
                          type: string
                        gpu:
                          format: int64
                          type: integer
                        gpuAction:
                          type: string
                        gpuVram:
                          format: int64
                          type: integer
                        gpuVramAction:
                          type: string
                        memAction:
                          type: string
                        memory:
                          format: int64
                          type: integer
                      type: object
                    recommendedRequest:
                      properties:
                        cpu:
                          format: int64
                          type: integer
                        cpuAction:
                          type: string
                        gpu:
                          format: int64
                          type: integer
                        gpuAction:
                          type: string
                        gpuVram:
                          format: int64
                          type: integer
                        gpuVramAction:
                          type: string
                        memAction:
                          type: string
                        memory:
                          format: int64
                          type: integer
                      type: object
                  required:
                  - containerName
                  type: object
                type: array
              detectionTriggers:
                description: DetectionTriggers contains the list of detection triggers
                  for the recommendation
                items:
                  description: DetectionTrigger represents a trigger for a detection
                  enum:
                  - PodCreation
                  - PodUpdate
                  type: string
                type: array
              enableInClusterMpa:
                description: EnableInClusterMpa indicates if the In-Cluster MPA (Fast
                  Reaction) controller should manage this workload
                type: boolean
              kedaScaledObjects:
                description: KEDAScaledObjects contains the list of KEDA scaling configuration
                  recommendations
                items:
                  description: |-
                    KedaScaledObjectRecommendationSpec is a plain Go struct for CRD serialization
                    replaces KedaScaledObjectRecommendationWrapper
                  properties:
                    maxReplicas:
                      format: int32
                      type: integer
                    minReplicas:
                      format: int32
                      type: integer
                    uid:
                      type: string
                  required:
                  - maxReplicas
                  - minReplicas
                  - uid
                  type: object
                type: array
              kind:
                description: Kind is the Kubernetes object kind (Deployment, StatefulSet,
                  etc.)
                type: string
              labelSelector:
                description: LabelSelector is the label selector to filter the target
                  workload
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements.
                      The requirements are ANDed.
                    items:
                      description: |-
                        A label selector requirement is a selector that contains values, a key, and an operator that
                        relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies
                            to.
                          type: string
                        operator:
                          description: |-
                            operator represents a key's relationship to a set of values.
                            Valid operators are In, NotIn, Exists and DoesNotExist.
                          type: string
                        values:
                          description: |-
                            values is an array of string values. If the operator is In or NotIn,
                            the values array must be non-empty. If the operator is Exists or DoesNotExist,
                            the values array must be empty. This array is replaced during a strategic
                            merge patch.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                    x-kubernetes-list-type: atomic
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: |-
                      matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                      map is equivalent to an element of matchExpressions, whose key field is "key", the
                      operator is "In", and the values array contains only "value". The requirements are ANDed.
                    type: object
                type: object
                x-kubernetes-map-type: atomic
              liveMigDeletionProp:
                description: LiveMigDeletionProp is set for when UseLiveMigration:true
                  and indicates how the snapshotted container should be handled.
                enum:
                - Orphaned
                - Foreground
                - Background
                type: string
              maxReplicas:
                description: MaxReplicas is the maximum allowed replica count
                format: int32
                type: integer
              minReplicas:
                description: MinReplicas is the minimum allowed replica count
                format: int32
                type: integer
              name:
                description: Name is the name of the target workload
                type: string
              namespace:
                description: Namespace is the namespace of the target workload
                type: string
              policyId:
                description: PolicyID is the control plane's UUID for the policy that
                  generated this recommendation
                type: string
              primaryMetric:
                description: PrimaryMetric is the primary metric used for HPA scaling
                type: string
              priority:
                description: Priority determines the order of applying recommendations
                  (higher priority applied first)
                format: int32
                type: integer
              recommendationId:
                description: RecommendationID is the unique identifier from the dakr
                  service
                type: string
              replicaCount:
                description: ReplicaCount is the recommended replica count
                format: int32
                type: integer
              ruleId:
                description: RuleID is the control plane's UUID for the WorkloadRule
                  that generated this recommendation
                type: string
              runtimeClassName:
                description: RuntimeClassName is the runtime class name for the workload
                type: string
              schedulerName:
                description: SchedulerName is the name for the custom scheduler this
                  workload should be scheduled by
                type: string
              targetUtilization:
                description: TargetUtilization is the target average utilization for
                  the primary metric (percentage)
                format: int32
                type: integer
              useLiveMigration:
                description: UseLiveMigration determines if this recommendation should
                  be applied through live migration
                type: boolean
              workloadUid:
                description: WorkloadUID is the Kubernetes UID of the target workload
                type: string
            required:
            - kind
            - name
            - namespace
            - recommendationId
            type: object
          status:
            default:
              phase: Pending
            description: WorkloadRecommendationStatus defines the observed state of
              WorkloadRecommendation
            properties:
              appliedAt:
                description: AppliedAt is the timestamp when the recommendation was
                  applied
                format: date-time
                type: string
              conditions:
                description: Conditions contains the current conditions of the recommendation
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              message:
                description: Message contains human-readable details about the current
                  state
                type: string
              observedGeneration:
                description: ObservedGeneration is the most recent generation observed
                  for this recommendation
                format: int64
                type: integer
              phase:
                default: Pending
                description: Phase represents the current phase of the recommendation
                enum:
                - Pending
                - Applying
                - Applied
                - Failed
                - Skipped
                - Migrating
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: workloadrules.dakr.devzero.io
spec:
  group: dakr.devzero.io
  names:
    kind: WorkloadRule
    listKind: WorkloadRuleList
    plural: workloadrules
    singular: workloadrule
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Status
      type: string
    - jsonPath: .spec.kind
      name: Kind
      type: string
    - jsonPath: .spec.name
      name: Workload
      type: string
    - jsonPath: .spec.generation
      name: Generation
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: WorkloadRule represents a set of rules for scaling a workload,
          generated by the MPA v2 Rules Engine
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkloadRuleSpec defines the desired state of a WorkloadRule
            properties:
              actionTriggers:
                description: ActionTriggers contains the list of action triggers for
                  the rule
                items:
                  description: ActionTrigger represents a trigger for an action
                  enum:
                  - OnDetection
                  - Immediate
                  type: string
                type: array
              classification:
                description: Workload classification (dominance + burstiness)
                properties:
                  burstiness:
                    description: Burstiness contains p95/p50 ratios per resource axis
                    properties:
                      cpu:
                        type: string
                      disk:
                        type: string
                      memory:
                        type: string
                      network:
                        type: string
                    type: object
                  dominantResource:
                    description: DominantResource is the resource axis this workload
                      is heaviest on
                    enum:
                    - cpu
                    - memory
                    - gpu
                    - network
                    - disk
                    - unknown
                    type: string
                type: object
              confidenceScore:
                description: ConfidenceScore indicates the confidence level of this
                  rule (0.0-1.0)
                type: string
              cpuRule:
                description: CPU Rule Configuration
                properties:
                  baseRequest:
                    description: BaseRequest is the base resource request value (e.g.,
                      "500m" for CPU or "1Gi" for memory)
                    type: string
                  enabled:
                    description: Enabled indicates if this resource rule is active
                    type: boolean
                  limitMultiplier:
                    description: LimitMultiplier is the multiplier to calculate limits
                      from requests (e.g., "1.5")
                    type: string
                  limitsAdjustmentEnabled:
                    description: LimitsAdjustmentEnabled indicates if limits should
                      be adjusted alongside requests
                    type: boolean
                  maxRequest:
                    description: MaxRequest is the maximum allowed resource request
                    type: string
                  maxScaleDownPercent:
                    description: MaxScaleDownPercent is the maximum percentage decrease
                      allowed per scaling event (e.g., "0.5" for 50%)
                    type: string
                  maxScaleUpPercent:
                    description: MaxScaleUpPercent is the maximum percentage increase
                      allowed per scaling event (e.g., "1.0" for 100%)
                    type: string
                  minRequest:
                    description: MinRequest is the minimum allowed resource request
                    type: string
                  targetPercentile:
                    description: TargetPercentile is the target percentile for resource
                      recommendations (e.g., "0.75" for P75)
                    type: string
                required:
                - enabled
                type: object
              cronSchedule:
                description: CronSchedule defines when rules should be evaluated (cron
                  expression)
                type: string
              emergencyResponse:
                description: EmergencyResponse defines reactive scaling behavior for
                  OOM and CPU throttling
                properties:
                  cpuThrottlingEnabled:
                    description: CPUThrottlingEnabled indicates if CPU throttling
                      response is active
                    type: boolean
                  cpuThrottlingMultiplier:
                    description: CPUThrottlingMultiplier is the multiplier for CPU
                      increase on throttling
                    type: string
                  cpuThrottlingThreshold:
                    description: CPUThrottlingThreshold is the fraction of time throttled
                      that triggers response (e.g., "0.10" = 10%)
                    type: string
                  oomCooldownSeconds:
                    description: OOMCooldownSeconds is the cooldown period between
                      OOM reactions
                    type: integer
                  oomEnabled:
                    description: OOMEnabled indicates if OOM response is active
                    type: boolean
                  oomMaxReactions:
                    description: OOMMaxReactions is the maximum number of OOM reactions
                      before waiting for control plane
                    type: integer
                  oomMemoryMultiplier:
                    description: OOMMemoryMultiplier is the multiplier for memory
                      increase on OOM (e.g., "1.5" = 50% increase)
                    type: string
                type: object
              generation:
                description: Generation is the rule generation number, incremented
                  on each update
                format: int64
                type: integer
              gpuRule:
                description: GPU Rule Configuration
                properties:
                  baseRequest:
                    description: BaseRequest is the base resource request value (e.g.,
                      "500m" for CPU or "1Gi" for memory)
                    type: string
                  enabled:
                    description: Enabled indicates if this resource rule is active
                    type: boolean
                  limitMultiplier:
                    description: LimitMultiplier is the multiplier to calculate limits
                      from requests (e.g., "1.5")
                    type: string
                  limitsAdjustmentEnabled:
                    description: LimitsAdjustmentEnabled indicates if limits should
                      be adjusted alongside requests
                    type: boolean
                  maxRequest:
                    description: MaxRequest is the maximum allowed resource request
                    type: string
                  maxScaleDownPercent:
                    description: MaxScaleDownPercent is the maximum percentage decrease
                      allowed per scaling event (e.g., "0.5" for 50%)
                    type: string
                  maxScaleUpPercent:
                    description: MaxScaleUpPercent is the maximum percentage increase
                      allowed per scaling event (e.g., "1.0" for 100%)
                    type: string
                  minRequest:
                    description: MinRequest is the minimum allowed resource request
                    type: string
                  targetPercentile:
                    description: TargetPercentile is the target percentile for resource
                      recommendations (e.g., "0.75" for P75)
                    type: string
                required:
                - enabled
                type: object
              hpaRule:
                description: HPA Rule Configuration
                properties:
                  enabled:
                    description: Enabled indicates if HPA scaling is active
                    type: boolean
                  maxReplicaChangePercent:
                    description: MaxReplicaChangePercent is the maximum percentage
                      of replicas to add/remove per scaling event
                    type: string
                  maxReplicas:
                    description: MaxReplicas is the maximum number of replicas
                    format: int32
                    type: integer
                  minReplicas:
                    description: MinReplicas is the minimum number of replicas
                    format: int32
                    type: integer
                  primaryMetric:
                    description: PrimaryMetric is the primary metric used for HPA
                      scaling decisions
                    type: string
                  targetUtilization:
                    description: TargetUtilization is the target average utilization
                      for the primary metric (e.g., "0.70" for 70%)
                    type: string
                required:
                - enabled
                type: object
              kind:
                description: Kind is the Kubernetes object kind (Deployment, StatefulSet,
                  etc.)
                type: string
              memoryRule:
                description: Memory Rule Configuration
                properties:
                  baseRequest:
                    description: BaseRequest is the base resource request value (e.g.,
                      "500m" for CPU or "1Gi" for memory)
                    type: string
                  enabled:
                    description: Enabled indicates if this resource rule is active
                    type: boolean
                  limitMultiplier:
                    description: LimitMultiplier is the multiplier to calculate limits
                      from requests (e.g., "1.5")
                    type: string
                  limitsAdjustmentEnabled:
                    description: LimitsAdjustmentEnabled indicates if limits should
                      be adjusted alongside requests
                    type: boolean
                  maxRequest:
                    description: MaxRequest is the maximum allowed resource request
                    type: string
                  maxScaleDownPercent:
                    description: MaxScaleDownPercent is the maximum percentage decrease
                      allowed per scaling event (e.g., "0.5" for 50%)
                    type: string
                  maxScaleUpPercent:
                    description: MaxScaleUpPercent is the maximum percentage increase
                      allowed per scaling event (e.g., "1.0" for 100%)
                    type: string
                  minRequest:
                    description: MinRequest is the minimum allowed resource request
                    type: string
                  targetPercentile:
                    description: TargetPercentile is the target percentile for resource
                      recommendations (e.g., "0.75" for P75)
                    type: string
                required:
                - enabled
                type: object
              name:
                description: Name is the name of the target workload
                type: string
              namespace:
                description: |-
                  Workload Reference
                  Namespace is the namespace of the target workload
                type: string
              outlierDetectionEnabled:
                description: OutlierDetectionEnabled indicates if outlier detection
                  is enabled for this workload
                type: boolean
              percentiles:
                description: Pre-computed percentiles per resource axis from control
                  plane
                properties:
                  cpu:
                    description: PercentileSet contains pre-computed percentile values
                      for a single resource axis
                    properties:
                      p50:
                        type: string
                      p80:
                        type: string
                      p90:
                        type: string
                      p95:
                        type: string
                      p99:
                        type: string
                    type: object
                  memory:
                    description: PercentileSet contains pre-computed percentile values
                      for a single resource axis
                    properties:
                      p50:
                        type: string
                      p80:
                        type: string
                      p90:
                        type: string
                      p95:
                        type: string
                      p99:
                        type: string
                    type: object
                type: object
              policyId:
                description: PolicyID is the control plane's UUID for the policy that
                  generated this rule
                type: string
              ruleId:
                description: RuleID is the control plane's UUID for this rule (for
                  tracking/linking)
                type: string
              startupPeriodSeconds:
                description: StartupPeriodSeconds is the duration to wait before applying
                  rules after pod startup
                format: int64
                type: integer
              version:
                description: Version is the MPA v2 engine version that generated this
                  rule
                type: string
            required:
            - generation
            - kind
            - name
            - namespace
            - version
            type: object
          status:
            default:
              phase: Active
            description: WorkloadRuleStatusInfo tracks rule evaluation status
            properties:
              conditions:
                description: Conditions contains the current conditions of the rule
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              currentCPUMillis:
                description: CurrentCPUMillis is the current CPU usage in millicores
                format: int64
                type: integer
              currentCPUUtilization:
                description: CurrentCPUUtilization is the current CPU utilization
                  (0.0-1.0)
                type: string
              currentMemoryBytes:
                description: CurrentMemoryBytes is the current memory usage in bytes
                format: int64
                type: integer
              currentMemoryUtilization:
                description: CurrentMemoryUtilization is the current memory utilization
                  (0.0-1.0)
                type: string
              evaluationCount:
                description: EvaluationCount is the total number of times this rule
                  has been evaluated
                format: int64
                type: integer
              failureCount:
                description: FailureCount is the number of failed evaluations
                format: int64
                type: integer
              lastEvaluatedAt:
                description: LastEvaluatedAt is the timestamp of the last rule evaluation
                format: date-time
                type: string
              lastOOMResponseTime:
                description: LastOOMResponseTime is the timestamp of the last OOM
                  response
                format: date-time
                type: string
              lastScaleTime:
                description: LastScaleTime is the timestamp of the last scaling action
                format: date-time
                type: string
              message:
                description: Message contains human-readable details about the current
                  state
                type: string
              oomReactionCount:
                description: OOMReactionCount is the number of OOM reactions performed
                  by in-cluster evaluator
                type: integer
              phase:
                default: Active
                description: Phase represents the current phase of the rule
                enum:
                - Active
                - Inactive
                - Failed
                type: string
              successCount:
                description: SuccessCount is the number of successful evaluations
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
